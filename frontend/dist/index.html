<input type="file" id="file" accept=".ips,.txt" />
<button id="an" class="btn">PhÃ¢n tÃ­ch</button>
<button id="up" class="btn" style="background-color:#0066ff">Cáº­p nháº­t Signatures</button>
<button id="usb" class="btn" style="background-color:#228B22">PhÃ¢n tÃ­ch qua iPhone USB</button>
<span id="deviceStatus" style="margin-left:12px;color:#666">Device: (checking...)</span>
// Khi báº¥m nÃºt "PhÃ¢n tÃ­ch qua iPhone USB"
document.getElementById("usb").onclick = async () => {
  document.getElementById("out").innerText = "ğŸ”Œ Äang láº¥y panic log tá»« iPhone...";
  try {
    // Gá»i hÃ m analyzeFromUSB() Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong preload.js
    const result = await window.panicAPI.analyzeFromUSB();
    // Hiá»ƒn thá»‹ káº¿t quáº£ phÃ¢n tÃ­ch dáº¡ng JSON
    document.getElementById("out").innerText = JSON.stringify(result, null, 2);
  } catch (err) {
    alert("âš ï¸ " + err.message);
    document.getElementById("out").innerText = "";
  }
};
// --- Device status poll & USB analysis handler ---
async function refreshDeviceStatus() {
  try {
    const devs = await window.panicAPI.listDevices();
    document.getElementById('deviceStatus').innerText = devs && devs.length ? ('Device: ' + devs[0]) : 'Device: (none)';
  } catch (e) {
    document.getElementById('deviceStatus').innerText = 'Device: (error)';
  }
}
setInterval(refreshDeviceStatus, 3000);
refreshDeviceStatus();

document.getElementById("usb").onclick = async () => {
  document.getElementById("out").innerText = "ğŸ”Œ Äang láº¥y panic log tá»« iPhone...";
  try {
    const result = await window.panicAPI.analyzeFromUSB();
    document.getElementById("out").innerText = JSON.stringify(result, null, 2);
  } catch (err) {
    alert("âš ï¸ " + err.message);
    document.getElementById("out").innerText = "";
  }
};
// --- end USB block ---
